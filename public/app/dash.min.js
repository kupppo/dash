class DotNetRandom{MBIG=2147483647;MSEED=161803398;inext;inextp;SeedArray=new Array(56);constructor(Seed){var ii,Seed=-2147483648==Seed?2147483647:Math.abs(Seed);let mj=this.MSEED-Seed,mk=(this.SeedArray[55]=mj,1);for(let i=1;i<55;i++)ii=21*i%55,this.SeedArray[ii]=mk,(mk=mj-mk)<0&&(mk+=this.MBIG),mj=this.SeedArray[ii];for(let k=1;k<5;k++)for(let i=1;i<56;i++)this.SeedArray[i]-=this.SeedArray[1+(i+30)%55],this.SeedArray[i]<0&&(this.SeedArray[i]+=this.MBIG);this.inext=0,this.inextp=21}Sample(){return this.InternalSample()*(1/this.MBIG)}InternalSample(){let locINext=this.inext,locINextp=this.inextp,retVal=(56<=++locINext&&(locINext=1),56<=++locINextp&&(locINextp=1),this.SeedArray[locINext]-this.SeedArray[locINextp]);return retVal==this.MBIG&&retVal--,retVal<0&&(retVal+=this.MBIG),this.SeedArray[locINext]=retVal,this.inext=locINext,this.inextp=locINextp,retVal}Next(){return this.InternalSample()}GetSampleForLargeRange(){let result=this.InternalSample();var negative=this.InternalSample()%2==0,negative=result=negative?-result:result;return(negative=(negative+=this.MBIG-1)/(2*this.MBIG-1))<0&&console.log("negative"),negative}NextInRange(minValue,maxValue){var methodName="DotNetRandom::Next(minValue,maxValue)",methodName=(maxValue<minValue&&console.log(methodName+" = min greater than max"),Number.isInteger(minValue)||console.log(methodName+" = min is non-integer"),Number.isInteger(maxValue)||console.log(methodName+" = max is non-integer"),maxValue-minValue);return methodName<=this.MBIG?Math.floor(this.Sample()*methodName)+minValue:Math.floor(this.GetSampleForLargeRange()*methodName)+minValue}Next(maxValue){return maxValue<0&&console.log("DotNetRandom::Next() = max is less than zero"),Number.isInteger(maxValue)||console.log("DotNetRandom::Next() = max is non-integer"),Math.floor(this.Sample()*maxValue)}NextDouble(){return Sample()}}const Area=Object.freeze({Crateria:0,BlueBrinstar:1,GreenBrinstar:2,PinkBrinstar:3,RedBrinstar:4,Kraid:5,Crocomire:6,WreckedShip:7,EastMaridia:8,WestMaridia:9,UpperNorfair:10,LowerNorfair:11}),AreaCounts=new Map([[Area.Crateria,3113017],[Area.PinkBrinstar,3113019],[Area.UpperNorfair,3113021],[Area.WreckedShip,3113023],[Area.EastMaridia,3113025],[Area.RedBrinstar,3113033],[Area.Kraid,3113035],[Area.WestMaridia,3113037],[Area.LowerNorfair,3113039],[Area.Crocomire,3113041]]);class Location{constructor(address,modifier,area,name){this.address=address,this.modifier=modifier,this.area=area,this.name=name}GetItemBytes(itemCode){itemCode+=this.modifier;return new Uint8Array([255&itemCode,itemCode>>8&255])}GetItemCode(bytes){return(bytes[this.address+1]<<8&65280|255&bytes[this.address])-this.modifier}}const loc=(addr,modifier,area,id,name)=>new Location(addr,modifier,area,name),getLocations=()=>[loc(493278,0,Area.BlueBrinstar,1,"Morphing Ball"),loc(491980,0,Area.Crateria,2,"Power Bombs (Landing Site)"),loc(492008,0,Area.Crateria,3,"Missiles (Ocean Bottom)"),loc(492014,168,Area.WreckedShip,4,"Missiles (Sky)"),loc(492020,0,Area.Crateria,5,"Missiles (Ocean Middle)"),loc(492104,0,Area.Crateria,6,"Missiles (Moat)"),loc(492132,0,Area.Crateria,7,"Energy Tank (Gauntlet)"),loc(492526,0,Area.Crateria,8,"Missiles (Mother Brain)"),loc(492548,84,Area.Crateria,9,"Bombs"),loc(492594,0,Area.Crateria,10,"Energy Tank (Terminator)"),loc(492644,0,Area.Crateria,11,"Missiles (Gauntlet Right)"),loc(492650,0,Area.Crateria,12,"Missiles (Gauntlet Left)"),loc(492664,0,Area.Crateria,13,"Supers (Climb)"),loc(492678,0,Area.Crateria,14,"Missiles (230)"),loc(492716,84,Area.GreenBrinstar,15,"Power Bombs (Etecoons)"),loc(492772,84,Area.PinkBrinstar,16,"Supers (Spore Spawn)"),loc(492824,0,Area.GreenBrinstar,17,"Missiles (Early Bridge)"),loc(492830,0,Area.GreenBrinstar,18,"Supers (Early Bridge)"),loc(492844,84,Area.GreenBrinstar,19,"Reserve Tank (Brinstar)"),loc(492850,168,Area.GreenBrinstar,20,"Missiles (Brin Reserve 2)"),loc(492856,0,Area.GreenBrinstar,21,"Missiles (Brin Reserve 1)"),loc(493064,0,Area.PinkBrinstar,22,"Missiles (Big Pink)"),loc(493070,0,Area.PinkBrinstar,23,"Missiles (Charge)"),loc(493076,84,Area.PinkBrinstar,24,"Charge Beam"),loc(493148,0,Area.PinkBrinstar,25,"Power Bombs (Mission Impossible)"),loc(493174,0,Area.GreenBrinstar,26,"Missiles (Brin Tube)"),loc(493388,0,Area.BlueBrinstar,27,"Power Bombs (Morph)"),loc(493464,0,Area.BlueBrinstar,28,"Missiles (Beta)"),loc(493470,168,Area.BlueBrinstar,29,"Energy Tank (Brinstar Ceiling)"),loc(493506,0,Area.GreenBrinstar,30,"Energy Tank (Etecoons)"),loc(493520,0,Area.GreenBrinstar,31,"Supers (Etecoons)"),loc(493562,0,Area.PinkBrinstar,32,"Energy Tank (Waterway)"),loc(493570,84,Area.BlueBrinstar,33,"Missiles (Alpha)"),loc(493604,0,Area.PinkBrinstar,34,"Energy Tank (Wave Gate)"),loc(493622,0,Area.BlueBrinstar,35,"Missiles (Billy Mays 1)"),loc(493628,168,Area.BlueBrinstar,36,"Missiles (Billy Mays 2)"),loc(493686,84,Area.RedBrinstar,37,"Xray Scope"),loc(493770,0,Area.RedBrinstar,38,"Power Bombs (Beta)"),loc(493838,84,Area.RedBrinstar,39,"Power Bombs (Alpha)"),loc(493844,0,Area.RedBrinstar,40,"Missiles (Alpha PBs)"),loc(493934,84,Area.RedBrinstar,41,"Spazer"),loc(493980,168,Area.Kraid,42,"Energy Tank (Kraid)"),loc(494060,168,Area.Kraid,43,"Missiles (Kraid)"),loc(494282,84,Area.Kraid,44,"Varia Suit"),loc(494308,168,Area.UpperNorfair,45,"Missiles (Cathedral)"),loc(494372,84,Area.UpperNorfair,46,"Ice Beam"),loc(494406,168,Area.UpperNorfair,47,"Missiles (Crumble Shaft)"),loc(494500,0,Area.Crocomire,48,"Energy Tank (Crocomire)"),loc(494508,84,Area.UpperNorfair,49,"HiJump Boots"),loc(494528,0,Area.UpperNorfair,50,"Missiles (Croc Escape)"),loc(494566,0,Area.UpperNorfair,51,"Missiles (HJB)"),loc(494572,0,Area.UpperNorfair,52,"Energy Tank (HJB)"),loc(494596,0,Area.Crocomire,53,"Power Bombs (Crocomire)"),loc(494612,0,Area.Crocomire,54,"Missiles (Cosine)"),loc(494634,0,Area.Crocomire,55,"Missiles (Indiana Jones)"),loc(494646,84,Area.Crocomire,56,"Grapple Beam"),loc(494654,84,Area.UpperNorfair,57,"Reserve Tank (Norfair)"),loc(494660,168,Area.UpperNorfair,58,"Missiles (Norfair Reserve 2)"),loc(494674,0,Area.UpperNorfair,59,"Missiles (Norfair Reserve 1)"),loc(494694,0,Area.UpperNorfair,60,"Missiles (Bubble Mountain)"),loc(494708,168,Area.UpperNorfair,61,"Missiles (Speed)"),loc(494722,84,Area.UpperNorfair,62,"Speed Booster"),loc(494780,0,Area.UpperNorfair,63,"Missiles (Wave)"),loc(494794,84,Area.UpperNorfair,64,"Wave Beam"),loc(495214,0,Area.LowerNorfair,65,"Missiles (GT)"),loc(495220,168,Area.LowerNorfair,66,"Supers (GT)"),loc(495408,0,Area.LowerNorfair,67,"Missiles (Mickey Mouse)"),loc(495562,0,Area.LowerNorfair,68,"Missiles (Maze)"),loc(495570,0,Area.LowerNorfair,69,"Power Bombs (Maze)"),loc(495808,0,Area.LowerNorfair,70,"Power Bombs (Shame)"),loc(495872,0,Area.LowerNorfair,71,"Missiles (Three Muskateers)"),loc(495880,168,Area.LowerNorfair,72,"Energy Tank (Ridley)"),loc(495888,84,Area.LowerNorfair,73,"Screw Attack"),loc(496004,0,Area.LowerNorfair,74,"Energy Tank (Firefleas)"),loc(508517,0,Area.WreckedShip,75,"Missiles (Spooky)"),loc(508649,84,Area.WreckedShip,76,"Reserve Tank (Wrecked Ship)"),loc(508655,0,Area.WreckedShip,77,"Missiles (Bowling)"),loc(508697,0,Area.WreckedShip,78,"Missiles (Attic)"),loc(508727,0,Area.WreckedShip,79,"Energy Tank (Wrecked Ship)"),loc(508759,0,Area.WreckedShip,80,"Supers (WS Left)"),loc(508773,0,Area.WreckedShip,81,"Supers (WS Right)"),loc(508781,84,Area.WreckedShip,82,"Gravity Suit"),loc(508983,0,Area.WestMaridia,83,"Missiles (Mainstreet)"),loc(508989,0,Area.WestMaridia,84,"Supers (Crab)"),loc(509053,0,Area.WestMaridia,85,"Energy Tank (Mama Turtle)"),loc(509059,168,Area.WestMaridia,86,"Missiles (Mama Turtle)"),loc(509103,0,Area.WestMaridia,87,"Supers (Watering Hole)"),loc(509109,0,Area.WestMaridia,88,"Missiles (Watering Hole)"),loc(509235,0,Area.WestMaridia,89,"Missiles (Beach)"),loc(509273,84,Area.EastMaridia,90,"Plasma Beam"),loc(509405,0,Area.EastMaridia,91,"Missiles (Sand Pit Left)"),loc(509411,84,Area.EastMaridia,92,"Reserve Tank (Maridia)"),loc(509419,0,Area.EastMaridia,93,"Missiles (Sand Pit Right)"),loc(509425,0,Area.EastMaridia,94,"Power Bombs (Sand Pit Right)"),loc(509443,0,Area.EastMaridia,95,"Missiles (Aqueduct)"),loc(509449,0,Area.EastMaridia,96,"Supers (Aqueduct)"),loc(509669,84,Area.EastMaridia,97,"Spring Ball"),loc(509773,168,Area.EastMaridia,98,"Missiles (Precious)"),loc(509781,0,Area.EastMaridia,99,"Energy Tank (Botwoon)"),loc(509863,84,Area.EastMaridia,100,"Space Jump")],Item=Object.freeze({EnergyTank:61143,Missile:61147,Super:61151,PowerBomb:61155,Bombs:61159,Charge:61163,Ice:61167,HJB:61171,Speed:61175,Wave:61179,Spazer:61183,SpringBall:61187,Varia:61191,Plasma:61203,Grapple:61207,Morph:61219,Reserve:61223,Gravity:61195,Xray:61199,SpaceJump:61211,ScrewAttack:61215,DoubleJump:61408,PressureValve:61416,HeatShield:61412,BeamUpgrade:61420}),ItemNames=new Map([[Item.EnergyTank,"Energy Tank"],[Item.Missile,"Missile"],[Item.Super,"Super Missile"],[Item.PowerBomb,"Power Bomb"],[Item.Bombs,"Bomb"],[Item.Charge,"Charge Beam"],[Item.Ice,"Ice Beam"],[Item.HJB,"HiJump Boots"],[Item.Speed,"Speed Booster"],[Item.Wave,"Wave Beam"],[Item.Spazer,"Spazer"],[Item.SpringBall,"Spring Ball"],[Item.Varia,"Varia Suit"],[Item.Plasma,"Plasma Beam"],[Item.Grapple,"Grappling Beam"],[Item.Morph,"Morph Ball"],[Item.Reserve,"Reserve Tank"],[Item.Gravity,"Gravity Suit"],[Item.Xray,"Xray Scope"],[Item.SpaceJump,"Space Jump"],[Item.ScrewAttack,"Screw Attack"],[Item.DoubleJump,"Double Jump"],[Item.PressureValve,"Pressure Valve"],[Item.HeatShield,"Heat Shield"],[Item.BeamUpgrade,"Beam Upgrade"]]),majorItem=(spoilerAddress,type,isProgression=!0)=>({type:type,name:ItemNames.get(type),isMajor:!0,isProgression:isProgression,spoilerAddress:spoilerAddress}),minorItem=(spoilerAddress,type,isProgression=!1)=>({type:type,name:ItemNames.get(type),isMajor:!1,isProgression:isProgression,spoilerAddress:spoilerAddress});class Loadout{hasBombs=!1;hasMorph=!1;hasGravity=!1;hasVaria=!1;hasHiJump=!1;hasSpaceJump=!1;hasScrewAttack=!1;hasSpringBall=!1;hasSpeed=!1;hasHeatShield=!1;hasPressureValve=!1;hasDoubleJump=!1;hasIce=!1;hasWave=!1;hasCharge=!1;hasSpazer=!1;hasPlasma=!1;hasGrapple=!1;missilePacks=0;superPacks=0;powerPacks=0;energyTanks=0;reserveTanks=0;totalTanks=0;canUseBombs=!1;canUsePowerBombs=!1;canPassBombPassages=!1;canDestroyBombWalls=!1;canOpenGreenDoors=!1;canOpenRedDoors=!1;canOpenYellowDoors=!1;canFly=!1;canCrystalFlash=!1;clone(){var copy=new Loadout;return copy.hasBombs=this.hasBombs,copy.hasMorph=this.hasMorph,copy.hasGravity=this.hasGravity,copy.hasVaria=this.hasVaria,copy.hasHiJump=this.hasHiJump,copy.hasSpaceJump=this.hasSpaceJump,copy.hasScrewAttack=this.hasScrewAttack,copy.hasSpringBall=this.hasSpringBall,copy.hasSpeed=this.hasSpeed,copy.hasHeatShield=copy.hasHeatShield,copy.hasPressureValve=copy.hasPressureValve,copy.hasDoubleJump=copy.hasDoubleJump,copy.hasIce=this.hasIce,copy.hasWave=this.hasWave,copy.hasCharge=this.hasCharge,copy.hasSpazer=this.hasSpazer,copy.hasPlasma=this.hasPlasma,copy.hasGrapple=this.hasGrapple,copy.missilePacks=this.missilePacks,copy.superPacks=this.superPacks,copy.powerPacks=this.powerPacks,copy.energyTanks=this.energyTanks,copy.reserveTanks=this.reserveTanks,copy.totalTanks=this.totalTanks,copy.canUseBombs=this.canUseBombs,copy.canUsePowerBombs=this.canUsePowerBombs,copy.canPassBombPassages=this.canPassBombPassages,copy.canDestroyBombWalls=this.canDestroyBombWalls,copy.canOpenGreenDoors=this.canOpenGreenDoors,copy.canOpenRedDoors=this.canOpenRedDoors,copy.canOpenYellowDoors=this.canOpenYellowDoors,copy.canFly=this.canFly,copy.canCrystalFlash=this.canCrystalFlash,copy}add(itemType){switch(itemType){case Item.Bombs:this.hasBombs=!0,this.canUseBombs=this.hasMorph,this.canPassBombPassages|=this.canUseBombs,this.canDestroyBombWalls|=this.canPassBombPassages,this.canFly|=this.canUseBombs;break;case Item.Morph:this.hasMorph=!0,this.canUseBombs=this.hasBombs,this.canUsePowerBombs=0<this.powerPacks,this.canPassBombPassages=this.canUseBombs||this.canUsePowerBombs,this.canDestroyBombWalls|=this.canPassBombPassages,this.canFly|=this.canUseBombs;break;case Item.Gravity:this.hasGravity=!0;break;case Item.PressureValve:this.hasPressureValve=!0;break;case Item.HeatShield:this.hasHeatShield=!0;break;case Item.Varia:this.hasVaria=!0;break;case Item.HJB:this.hasHiJump=!0;break;case Item.DoubleJump:this.hasDoubleJump=!0;break;case Item.SpaceJump:this.hasSpaceJump=!0,this.canFly=!0;break;case Item.ScrewAttack:this.hasScrewAttack=!0,this.canDestroyBombWalls=!0;break;case Item.SpringBall:this.hasSpringBall=!0;break;case Item.Speed:this.hasSpeed=!0;break;case Item.Ice:this.hasIce=!0;break;case Item.Wave:this.hasWave=!0;break;case Item.Charge:this.hasCharge=!0;break;case Item.Spazer:this.hasSpazer=!0;break;case Item.Plasma:this.hasPlasma=!0;break;case Item.Grapple:this.hasGrapple=!0;break;case Item.Missile:this.missilePacks+=1,this.canOpenRedDoors=!0,this.canCrystalFlash=1<this.missilePacks&&1<this.superPacks&&2<this.powerPacks;break;case Item.Super:this.superPacks+=1,this.canOpenGreenDoors=!0,this.canOpenRedDoors=!0,this.canCrystalFlash=1<this.missilePacks&&1<this.superPacks&&2<this.powerPacks;break;case Item.PowerBomb:this.powerPacks+=1,this.canUsePowerBombs=this.hasMorph,this.canPassBombPassages|=this.canUsePowerBombs,this.canDestroyBombWalls|=this.canPassBombPassages,this.canCrystalFlash=1<this.missilePacks&&1<this.superPacks&&2<this.powerPacks;break;case Item.EnergyTank:this.energyTanks+=1,this.totalTanks+=1;break;case Item.Reserve:this.reserveTanks+=1,this.totalTanks+=1;break;case Item.BeamUpgrade:case Item.Xray:break;default:console.error("[Loadout] Unknown item type:",ItemNames.get(itemType))}}}class Node{constructor(name,location,isMajor,available){this.name=name,this.location=location,this.isMajor=isMajor,this.sortWeight=0,this.available=available,this.item=void 0}Clone(){var copy=new Node(this.name,this.location,this.isMajor,this.available);return copy.sortWeight=this.sortWeight,copy.item=this.item,copy}GetWeight(){return this.location.area==Area.LowerNorfair?11:this.location.area==Area.WreckedShip?12:0}SetItem(item){this.item=item}}const isEmptyNode=(_,node)=>null==node.item,isValidMajorMinor=(item,node)=>{if(!isEmptyNode(item,node))return!1;if(item.isMajor!=node.isMajor)return!1;if(item.type==Item.Gravity){if(node.location.area==Area.Crateria)return!1}else{if(item.type!=Item.Varia)return!0;if(node.location.area==Area.LowerNorfair||node.location.area==Area.Crateria)return!1}switch(node.location.address){case 493278:case 493464:case 493470:return!1;default:return!0}},getFullPrePool=rnd=>{switch(prePool=[Item.Morph],rnd.Next(100)<65?prePool.push(Item.Missile):prePool.push(Item.Super),rnd.Next(13)){case 0:prePool.push(Item.Missile,Item.ScrewAttack);break;case 1:prePool.push(Item.Missile,Item.Speed);break;case 2:prePool.push(Item.Missile,Item.Bombs)}return prePool.push(Item.PowerBomb),prePool},getMajorMinorPrePool=rnd=>{switch(prePool=[Item.Morph],rnd.Next(100)<65?prePool.push(Item.Missile):prePool.push(Item.Super),rnd.Next(13)){case 0:prePool.push(Item.Speed);break;case 1:case 2:prePool.push(Item.ScrewAttack);break;case 3:case 4:case 5:case 6:prePool.push(Item.Bombs);break;default:prePool.push(Item.PowerBomb)}return prePool},performVerifiedFill=(seed,nodes,itemPool,getPrePool,initLoad,canPlaceItem)=>{const rnd=new DotNetRandom(seed),shuffle=arr=>{for(let i=0;i<arr.length;i++)((arr,x,y)=>{var tmp=arr[x];arr[x]=arr[y],arr[y]=tmp})(arr,i,rnd.NextInRange(i,arr.length))};let shuffledLocations=[...nodes],prefillLoadout=(shuffle(shuffledLocations),initLoad.clone());getPrePool(rnd).forEach(itemType=>{var itemIndex=itemPool.findIndex(i=>i.type==itemType);const item=itemPool.splice(itemIndex,1)[0];shuffledLocations.find(n=>n.available(prefillLoadout)&&canPlaceItem(item,n)).SetItem(item),prefillLoadout.add(itemType)});var nonPrefilled=shuffledLocations.filter(n=>null==n.item);let attempts=0;for(;attempts<100&&(attempts+=1,nonPrefilled.forEach(n=>n.item=void 0),!((itemPool,nodes)=>{var shuffledItems=[...itemPool];shuffle(shuffledItems);for(let j=0;j<nodes.length;j++){let n=nodes[j];var itemIndex=shuffledItems.findIndex(i=>canPlaceItem(i,n));if(itemIndex<0)return!1;n.item=shuffledItems.splice(itemIndex,1)[0]}return!0})(itemPool,nonPrefilled)||!verifyItemProgression(nodes,null)););},verifyItemProgression=(nodes,log)=>{let load=new Loadout;for(var copy=[...nodes];0<copy.length;){var nodeIndex=copy.findIndex(n=>n.available(load));if(nodeIndex<0)return!1;nodeIndex=copy.splice(nodeIndex,1)[0];null!=log&&log.push({item:nodeIndex.item,location:nodeIndex.location}),load.add(nodeIndex.item.type)}return!0};class ModeStandard{nodes=[];constructor(seed,locations){this.itemPool=this.setupItemPool(seed),this.setupNodes(locations)}setupItemPool(seed){seed=new DotNetRandom(seed);let itemPool=[majorItem(0,Item.EnergyTank,!1),minorItem(0,Item.Missile),minorItem(0,Item.Super),minorItem(0,Item.PowerBomb),majorItem(3112969,Item.Bombs),majorItem(3113003,Item.Charge,!1),majorItem(3112971,Item.Ice),majorItem(3112983,Item.HJB),majorItem(3112987,Item.Speed),majorItem(3112973,Item.Wave),majorItem(3112975,Item.Spazer,!1),majorItem(3112991,Item.SpringBall),majorItem(3112979,Item.Varia),majorItem(3112977,Item.Plasma),majorItem(3112995,Item.Grapple),majorItem(3112967,Item.Morph),majorItem(0,Item.Reserve),majorItem(3112981,Item.Gravity),majorItem(3112993,Item.Xray,!1),majorItem(3112985,Item.SpaceJump),majorItem(3112989,Item.ScrewAttack)];var setAmountInPool=(type,count)=>{const item=itemPool.find(i=>i.type==type);for(;itemPool.filter(i=>i==item).length<count;)itemPool.unshift(item)},numSupers=12+seed.Next(7),seed=14+seed.Next(7),numMissiles=66-numSupers-seed;return setAmountInPool(Item.Reserve,4),setAmountInPool(Item.EnergyTank,14),setAmountInPool(Item.Missile,numMissiles),setAmountInPool(Item.Super,numSupers),setAmountInPool(Item.PowerBomb,seed),itemPool}setupNodes(locations){let add=(name,isMajor,available)=>{var loc=locations.find(p=>p.name==name);this.nodes.push(new Node(name,loc,isMajor,available))};var major=(n,a)=>add(n,!0,a),minor=(n,a)=>add(n,!1,a);const canHellRun=load=>3<=load.totalTanks||load.hasVaria,canAccessRedBrinstar=load=>1<=load.superPacks&&(load.canUsePowerBombs||load.canDestroyBombWalls&&load.hasMorph),canAccessHeatedNorfair=load=>canAccessRedBrinstar(load)&&canHellRun(load),canAccessLowerNorfair=load=>canAccessHeatedNorfair(load)&&load.canUsePowerBombs&&load.hasVaria&&(load.hasHiJump||load.hasGravity),canPassWorstRoom=load=>canAccessLowerNorfair(load)&&(load.canFly||load.hasHiJump||load.hasSpringBall||load.hasIce&&load.hasCharge),canAccessKraid=load=>canAccessRedBrinstar(load)&&load.canPassBombPassages,canAccessCrocomire=load=>canAccessHeatedNorfair(load)||canAccessKraid(load)&&load.canUsePowerBombs&&load.hasSpeed&&2<=load.totalTanks,canDoSuitlessMaridia=load=>load.hasHiJump&&load.hasGrapple&&(load.hasIce||load.hasSpringBall),canDefeatBotwoon=load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs&&(load.hasIce||load.hasSpeed)&&(load.hasGravity||canDoSuitlessMaridia(load)&&load.hasIce),canDefeatDraygon=load=>canDefeatBotwoon(load)&&load.hasGravity,canAccessWreckedShip=load=>load.canUsePowerBombs&&1<=load.superPacks,canAccessOuterMaridia=load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs&&(load.hasGravity||load.hasHiJump&&(load.hasIce||load.hasSpringBall)),canAccessInnerMaridia=load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs&&load.hasGravity,canEnterAndLeaveGauntlet=load=>load.canUseBombs||load.hasScrewAttack||load.canUsePowerBombs&&2<=load.powerPacks||load.hasSpeed&&load.canUsePowerBombs&&2<=load.totalTanks;major("Bombs",load=>load.hasMorph&&load.canOpenRedDoors),major("Energy Tank (Brinstar Ceiling)",load=>!0),major("Energy Tank (Gauntlet)",load=>canEnterAndLeaveGauntlet(load)),major("Energy Tank (Terminator)",load=>load.canDestroyBombWalls||load.hasSpeed),minor("Missiles (230)",load=>load.canPassBombPassages),minor("Missiles (Alpha)",load=>load.hasMorph),minor("Missiles (Beta)",load=>load.hasMorph),minor("Missiles (Billy Mays 1)",load=>load.canUsePowerBombs),minor("Missiles (Billy Mays 2)",load=>load.canUsePowerBombs),minor("Missiles (Gauntlet Left)",load=>canEnterAndLeaveGauntlet(load)&&load.canPassBombPassages),minor("Missiles (Gauntlet Right)",load=>canEnterAndLeaveGauntlet(load)&&load.canPassBombPassages),minor("Missiles (Moat)",load=>canAccessWreckedShip(load)),minor("Missiles (Mother Brain)",load=>load.canDestroyBombWalls),major("Morphing Ball",load=>!0),minor("Power Bombs (Landing Site)",load=>load.canUsePowerBombs&&(load.hasSpeed||load.canFly)),minor("Power Bombs (Morph)",load=>load.canUsePowerBombs),minor("Supers (Climb)",load=>load.canUsePowerBombs&&load.hasSpeed&&2<=load.energyTanks&&3<=load.totalTanks),major("Energy Tank (Crocomire)",load=>canAccessCrocomire(load)),major("Grapple Beam",load=>canAccessCrocomire(load)),minor("Missiles (Cosine)",load=>canAccessCrocomire(load)),minor("Missiles (Indiana Jones)",load=>canAccessCrocomire(load)&&(load.canFly||load.hasGrapple||load.hasSpeed)),minor("Power Bombs (Crocomire)",load=>canAccessCrocomire(load)),major("Energy Tank (Botwoon)",load=>canDefeatBotwoon(load)),minor("Missiles (Aqueduct)",load=>canAccessOuterMaridia(load)&&load.hasGravity),minor("Missiles (Precious)",load=>canDefeatDraygon(load)),minor("Missiles (Sand Pit Left)",load=>canAccessOuterMaridia(load)&&(canDoSuitlessMaridia(load)||load.hasGravity)),minor("Missiles (Sand Pit Right)",load=>canAccessInnerMaridia(load)),major("Plasma Beam",load=>canDefeatDraygon(load)&&(load.hasCharge&&3<=load.totalTanks||load.hasScrewAttack||load.hasPlasma)&&(load.hasHiJump||load.hasSpringBall||load.canFly||load.hasSpeed)),minor("Power Bombs (Sand Pit Right)",load=>canAccessOuterMaridia(load)&&load.hasGravity),major("Reserve Tank (Maridia)",load=>canAccessOuterMaridia(load)&&load.hasGravity),major("Space Jump",load=>canDefeatDraygon(load)),major("Spring Ball",load=>canAccessInnerMaridia(load)&&(load.hasIce||load.hasGrapple&&(load.canFly||load.hasHiJump))),minor("Supers (Aqueduct)",load=>canAccessOuterMaridia(load)&&load.hasGravity),major("Charge Beam",load=>load.canUsePowerBombs||load.canOpenRedDoors&&load.canPassBombPassages),major("Energy Tank (Etecoons)",load=>load.canUsePowerBombs),major("Energy Tank (Waterway)",load=>load.canUsePowerBombs&&load.canOpenRedDoors&&load.hasSpeed),major("Energy Tank (Wave Gate)",load=>load.canUsePowerBombs&&(load.hasWave||0<load.superPacks)),minor("Missiles (Big Pink)",load=>load.canUsePowerBombs||load.canOpenRedDoors&&(load.hasSpeed||load.canDestroyBombWalls)),minor("Missiles (Brin Reserve 1)",load=>load.canOpenRedDoors&&load.canDestroyBombWalls&&load.hasMorph),minor("Missiles (Brin Reserve 2)",load=>load.canOpenRedDoors&&load.canPassBombPassages),minor("Missiles (Brin Tube)",load=>load.canUsePowerBombs||load.canPassBombPassages&&load.canOpenGreenDoors),minor("Missiles (Charge)",load=>load.canUsePowerBombs||load.canOpenRedDoors&&(load.hasSpeed||load.canDestroyBombWalls)),minor("Missiles (Early Bridge)",load=>load.canOpenRedDoors&&(load.hasSpeed||load.canDestroyBombWalls)),minor("Power Bombs (Etecoons)",load=>load.canUsePowerBombs),minor("Power Bombs (Mission Impossible)",load=>load.canUsePowerBombs&&0<load.superPacks),major("Reserve Tank (Brinstar)",load=>load.canOpenRedDoors&&(load.hasSpeed||load.canDestroyBombWalls)&&(load.hasMorph||load.hasSpeed)),minor("Supers (Early Bridge)",load=>load.canOpenRedDoors&&(load.hasSpeed||load.canDestroyBombWalls)&&(load.hasMorph||load.hasSpeed)),minor("Supers (Etecoons)",load=>load.canUsePowerBombs&&load.canOpenGreenDoors),minor("Supers (Spore Spawn)",load=>load.canPassBombPassages&&0<load.superPacks),major("Energy Tank (Kraid)",load=>canAccessKraid(load)),minor("Missiles (Kraid)",load=>canAccessKraid(load)&&load.canUsePowerBombs),major("Varia Suit",load=>canAccessKraid(load)),major("Energy Tank (Firefleas)",load=>canPassWorstRoom(load)),major("Energy Tank (Ridley)",load=>canPassWorstRoom(load)),minor("Missiles (GT)",load=>canAccessLowerNorfair(load)&&load.hasSpaceJump),minor("Missiles (Maze)",load=>canPassWorstRoom(load)),minor("Missiles (Mickey Mouse)",load=>canPassWorstRoom(load)),minor("Missiles (Three Muskateers)",load=>canPassWorstRoom(load)),minor("Power Bombs (Maze)",load=>canPassWorstRoom(load)),minor("Power Bombs (Shame)",load=>canPassWorstRoom(load)),major("Screw Attack",load=>canAccessLowerNorfair(load)&&(load.canFly||load.hasSpringBall||load.hasSpeed)),minor("Supers (GT)",load=>canAccessLowerNorfair(load)),minor("Missiles (Alpha PBs)",load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs),minor("Power Bombs (Alpha)",load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs),minor("Power Bombs (Beta)",load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs),major("Spazer",load=>canAccessRedBrinstar(load)),major("Xray Scope",load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs&&(load.hasGrapple||load.hasSpaceJump||6<=load.totalTanks||load.hasVaria&&4<=load.totalTanks)),minor("Energy Tank (HJB)",load=>canAccessRedBrinstar(load)),major("HiJump Boots",load=>canAccessRedBrinstar(load)),major("Ice Beam",load=>canAccessKraid(load)&&(load.hasVaria||2<=load.totalTanks)),minor("Missiles (Bubble Mountain)",load=>canAccessHeatedNorfair(load)),minor("Missiles (Cathedral)",load=>canAccessHeatedNorfair(load)),minor("Missiles (Croc Escape)",load=>canAccessCrocomire(load)&&(load.canFly||load.hasGrapple||load.hasIce||load.hasHiJump&&load.hasSpeed)),minor("Missiles (Crumble Shaft)",load=>canAccessKraid(load)&&load.canUsePowerBombs&&canHellRun(load)),minor("Missiles (HJB)",load=>canAccessRedBrinstar(load)),minor("Missiles (Norfair Reserve 1)",load=>canAccessHeatedNorfair(load)&&(load.canFly||load.hasGrapple||load.hasIce||load.hasSpringBall||load.hasHiJump)),minor("Missiles (Norfair Reserve 2)",load=>canAccessHeatedNorfair(load)&&(load.canFly||load.hasGrapple||load.hasIce||load.hasSpringBall||load.hasHiJump)),minor("Missiles (Speed)",load=>canAccessHeatedNorfair(load)),minor("Missiles (Wave)",load=>canAccessHeatedNorfair(load)),major("Reserve Tank (Norfair)",load=>canAccessHeatedNorfair(load)&&(load.canFly||load.hasGrapple||load.hasIce||load.hasSpringBall||load.hasHiJump)),major("Speed Booster",load=>canAccessHeatedNorfair(load)),major("Wave Beam",load=>canAccessHeatedNorfair(load)),major("Energy Tank (Mama Turtle)",load=>canAccessOuterMaridia(load)&&(load.canFly||load.hasSpeed||load.hasGrapple)),minor("Missiles (Beach)",load=>canAccessInnerMaridia(load)),minor("Missiles (Mainstreet)",load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs&&load.hasGravity&&load.hasSpeed),minor("Missiles (Mama Turtle)",load=>canAccessOuterMaridia(load)),minor("Missiles (Watering Hole)",load=>canAccessInnerMaridia(load)),minor("Supers (Crab)",load=>canAccessOuterMaridia(load)),minor("Supers (Watering Hole)",load=>canAccessInnerMaridia(load)),major("Energy Tank (Wrecked Ship)",load=>canAccessWreckedShip(load)&&(load.canUseBombs||load.canUsePowerBombs||load.hasHiJump||load.hasSpaceJump||load.hasSpeed||load.hasSpringBall)),major("Gravity Suit",load=>canAccessWreckedShip(load)&&(load.hasVaria||1<=load.totalTanks)),minor("Missiles (Attic)",load=>canAccessWreckedShip(load)),minor("Missiles (Bowling)",load=>canAccessWreckedShip(load)&&(load.hasVaria||1<=load.totalTanks)),minor("Missiles (Ocean Bottom)",load=>canAccessWreckedShip(load)),minor("Missiles (Ocean Middle)",load=>canAccessWreckedShip(load)),minor("Missiles (Sky)",load=>canAccessWreckedShip(load)),minor("Missiles (Spooky)",load=>canAccessWreckedShip(load)),major("Reserve Tank (Wrecked Ship)",load=>canAccessWreckedShip(load)&&load.hasSpeed&&(load.hasVaria&&1<=load.totalTanks||2<=load.totalTanks)),minor("Supers (WS Left)",load=>canAccessWreckedShip(load)),major("Supers (WS Right)",load=>canAccessWreckedShip(load))}}class ModeRecall{nodes=[];constructor(seed,locations){this.itemPool=this.setupItemPool(seed),this.setupNodes(locations)}setupItemPool(seed){seed=new DotNetRandom(seed);let itemPool=[majorItem(0,Item.EnergyTank,!1),minorItem(0,Item.Missile),minorItem(0,Item.Super),minorItem(0,Item.PowerBomb),majorItem(3112969,Item.Bombs),majorItem(3113005,Item.BeamUpgrade,!1),majorItem(3112971,Item.Ice),majorItem(3112983,Item.HJB),majorItem(3112987,Item.Speed),majorItem(3112973,Item.Wave),majorItem(3112975,Item.Spazer),majorItem(3112991,Item.SpringBall),majorItem(3112979,Item.Varia),majorItem(3112977,Item.Plasma),majorItem(3112995,Item.Grapple),majorItem(3112967,Item.Morph),majorItem(0,Item.Reserve),majorItem(3112981,Item.Gravity),majorItem(3112993,Item.Xray,!1),majorItem(3112985,Item.SpaceJump),majorItem(3112989,Item.ScrewAttack),majorItem(3113001,Item.DoubleJump),majorItem(3112999,Item.PressureValve),majorItem(3112997,Item.HeatShield),majorItem(3113007,Item.BeamUpgrade,!1),majorItem(3113009,Item.BeamUpgrade,!1),majorItem(3113011,Item.BeamUpgrade,!1)];var setAmountInPool=(type,count)=>{const item=itemPool.find(i=>i.type==type);for(;itemPool.filter(i=>i==item).length<count;)itemPool.unshift(item)},numSupers=15+seed.Next(4),seed=15+seed.Next(4),numMissiles=64-numSupers-seed;return setAmountInPool(Item.Reserve,2),setAmountInPool(Item.EnergyTank,12),setAmountInPool(Item.Missile,numMissiles),setAmountInPool(Item.Super,numSupers),setAmountInPool(Item.PowerBomb,seed),itemPool}setupNodes(locations){let add=(name,isMajor,available)=>{var loc=locations.find(p=>p.name==name);this.nodes.push(new Node(name,loc,isMajor,available))};var major=(n,a)=>add(n,!0,a),minor=(n,a)=>add(n,!1,a);locations.find(l=>"Reserve Tank (Wrecked Ship)"==l.name).modifier=0;const canHellRun=load=>4<=load.totalTanks||3<=load.totalTanks&&load.hasGravity||load.hasVaria||load.hasHeatShield,canAccessRedBrinstar=load=>1<=load.superPacks&&(load.canUsePowerBombs||load.canDestroyBombWalls&&load.hasMorph),canAccessHeatedNorfair=load=>canAccessRedBrinstar(load)&&canHellRun(load),canAccessLowerNorfair=load=>canAccessHeatedNorfair(load)&&load.canUsePowerBombs&&load.hasVaria&&(load.hasHiJump||load.hasGravity),canPassWorstRoom=load=>canAccessLowerNorfair(load)&&(load.canFly||load.hasHiJump||load.hasSpringBall||load.hasDoubleJump||load.hasIce&&load.hasCharge),canAccessKraid=load=>canAccessRedBrinstar(load)&&load.canPassBombPassages,canAccessCrocomire=load=>canAccessHeatedNorfair(load)||canAccessKraid(load)&&load.canUsePowerBombs&&load.hasSpeed&&2<=load.totalTanks,canDoSuitlessMaridia=load=>load.hasHiJump&&load.hasGrapple&&(load.hasIce||load.hasSpringBall),canDefeatBotwoon=load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs&&(load.hasIce||load.hasSpeed||load.hasSpazer)&&(load.hasGravity||canDoSuitlessMaridia(load)&&load.hasIce),canDefeatDraygon=load=>canDefeatBotwoon(load)&&load.hasGravity,canAccessWreckedShip=load=>load.canUsePowerBombs&&1<=load.superPacks,canAccessWestMaridia=load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs&&(load.hasGravity||load.hasPressureValve||load.hasHiJump&&(load.hasIce||load.hasSpringBall));const canEnterAndLeaveGauntlet=load=>load.canUseBombs&&2<=load.totalTanks||load.hasScrewAttack||load.canUsePowerBombs&&2<=load.powerPacks&&1<=load.totalTanks;major("Bombs",load=>load.hasMorph&&load.canOpenRedDoors),major("Energy Tank (Brinstar Ceiling)",load=>!0),major("Energy Tank (Gauntlet)",load=>canEnterAndLeaveGauntlet(load)),major("Energy Tank (Terminator)",load=>load.canDestroyBombWalls||load.hasSpeed),minor("Missiles (230)",load=>load.canPassBombPassages),minor("Missiles (Alpha)",load=>load.hasMorph),minor("Missiles (Beta)",load=>load.hasMorph),minor("Missiles (Billy Mays 1)",load=>load.canUsePowerBombs),minor("Missiles (Billy Mays 2)",load=>load.canUsePowerBombs),minor("Missiles (Gauntlet Left)",load=>canEnterAndLeaveGauntlet(load)&&load.canPassBombPassages),minor("Missiles (Gauntlet Right)",load=>canEnterAndLeaveGauntlet(load)&&load.canPassBombPassages),minor("Missiles (Moat)",load=>canAccessWreckedShip(load)),minor("Missiles (Mother Brain)",load=>load.canDestroyBombWalls),major("Morphing Ball",load=>!0),minor("Power Bombs (Landing Site)",load=>load.canUsePowerBombs&&(load.hasSpeed&&1<=load.totalTanks||load.canFly)),minor("Power Bombs (Morph)",load=>load.canUsePowerBombs),minor("Supers (Climb)",load=>load.canUsePowerBombs&&load.hasSpeed&&2<=load.energyTanks&&3<=load.totalTanks),major("Energy Tank (Crocomire)",load=>canAccessCrocomire(load)),major("Grapple Beam",load=>canAccessCrocomire(load)),minor("Missiles (Cosine)",load=>canAccessCrocomire(load)),minor("Missiles (Indiana Jones)",load=>canAccessCrocomire(load)&&(load.canFly||load.hasSpeed)),minor("Power Bombs (Crocomire)",load=>canAccessCrocomire(load)),major("Energy Tank (Botwoon)",load=>canDefeatBotwoon(load)),minor("Missiles (Aqueduct)",load=>canAccessWestMaridia(load)&&load.hasGravity),minor("Missiles (Precious)",load=>canDefeatDraygon(load)),minor("Missiles (Sand Pit Left)",load=>canAccessWestMaridia(load)&&load.hasGravity),minor("Missiles (Sand Pit Right)",load=>canAccessWestMaridia(load)&&load.hasGravity),major("Plasma Beam",load=>canAccessWreckedShip(load)&&(load.hasGravity||load.hasPressureValve)),minor("Power Bombs (Sand Pit Right)",load=>canAccessWestMaridia(load)&&load.hasGravity),major("Reserve Tank (Maridia)",load=>canAccessWestMaridia(load)&&load.hasGravity),major("Space Jump",load=>canDefeatDraygon(load)),major("Spring Ball",load=>canAccessWreckedShip(load)&&(load.hasGravity||load.hasPressureValve)),minor("Supers (Aqueduct)",load=>canAccessWestMaridia(load)&&load.hasGravity),major("Charge Beam",load=>load.canUsePowerBombs||load.canOpenRedDoors&&load.canPassBombPassages),major("Energy Tank (Etecoons)",load=>load.canUsePowerBombs),major("Energy Tank (Waterway)",load=>load.canUsePowerBombs&&load.canOpenRedDoors&&(load.hasSpeed||load.hasSpazer)),major("Energy Tank (Wave Gate)",load=>load.canUsePowerBombs&&(load.hasWave||0<load.superPacks)),minor("Missiles (Big Pink)",load=>load.canUsePowerBombs||load.canOpenRedDoors&&(load.hasSpeed||load.canDestroyBombWalls)),minor("Missiles (Brin Reserve 1)",load=>load.canOpenRedDoors&&load.canPassBombPassages),minor("Missiles (Brin Reserve 2)",load=>load.canOpenRedDoors&&load.canDestroyBombWalls&&load.hasMorph),minor("Missiles (Brin Tube)",load=>load.canUsePowerBombs||load.canPassBombPassages&&load.canOpenGreenDoors),minor("Missiles (Charge)",load=>load.canUsePowerBombs||load.canOpenRedDoors&&(load.hasSpeed||load.canDestroyBombWalls)),minor("Missiles (Early Bridge)",load=>load.canOpenRedDoors&&load.canDestroyBombWalls),minor("Power Bombs (Etecoons)",load=>load.canUsePowerBombs),minor("Power Bombs (Mission Impossible)",load=>load.canUsePowerBombs&&0<load.superPacks),major("Reserve Tank (Brinstar)",load=>load.canOpenRedDoors&&load.canDestroyBombWalls&&load.hasMorph),minor("Supers (Early Bridge)",load=>load.canOpenRedDoors&&load.canDestroyBombWalls&&load.hasMorph),minor("Supers (Etecoons)",load=>load.canUsePowerBombs&&load.canOpenGreenDoors),minor("Supers (Spore Spawn)",load=>load.canPassBombPassages&&0<load.superPacks),minor("Energy Tank (Kraid)",load=>canAccessKraid(load)),minor("Missiles (Kraid)",load=>canAccessKraid(load)&&load.canUsePowerBombs),major("Varia Suit",load=>canAccessKraid(load)),major("Energy Tank (Firefleas)",load=>canPassWorstRoom(load)),major("Energy Tank (Ridley)",load=>canPassWorstRoom(load)),minor("Missiles (GT)",load=>canAccessLowerNorfair(load)&&load.hasSpaceJump),minor("Missiles (Maze)",load=>canPassWorstRoom(load)),major("Missiles (Mickey Mouse)",load=>canPassWorstRoom(load)),minor("Missiles (Three Muskateers)",load=>canPassWorstRoom(load)),minor("Power Bombs (Maze)",load=>canPassWorstRoom(load)),minor("Power Bombs (Shame)",load=>canPassWorstRoom(load)),major("Screw Attack",load=>canAccessLowerNorfair(load)&&(load.canFly||load.hasDoubleJump||load.hasSpringBall||load.hasSpeed)),minor("Supers (GT)",load=>canAccessLowerNorfair(load)),minor("Missiles (Alpha PBs)",load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs),minor("Power Bombs (Alpha)",load=>canAccessRedBrinstar(load)),minor("Power Bombs (Beta)",load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs),major("Spazer",load=>canAccessRedBrinstar(load)),major("Xray Scope",load=>canAccessRedBrinstar(load)&&load.canUsePowerBombs&&(load.hasGrapple||load.hasSpaceJump||6<=load.totalTanks||load.hasVaria&&3<=load.totalTanks||load.hasDoubleJump&&4<=load.totalTanks||load.hasHiJump&&load.hasSpeed&&4<=load.totalTanks||load.hasIce&&4<=load.totalTanks)),minor("Energy Tank (HJB)",load=>canAccessRedBrinstar(load)),major("HiJump Boots",load=>canAccessRedBrinstar(load)),major("Ice Beam",load=>canAccessKraid(load)&&(load.hasVaria||2<=load.totalTanks||load.hasHeatShield)),minor("Missiles (Bubble Mountain)",load=>canAccessHeatedNorfair(load)),minor("Missiles (Cathedral)",load=>canAccessHeatedNorfair(load)),minor("Missiles (Croc Escape)",load=>canAccessCrocomire(load)&&(load.canFly||load.hasGrapple||load.hasDoubleJump||load.hasHiJump&&load.hasSpeed)),minor("Missiles (Crumble Shaft)",load=>canAccessKraid(load)&&load.canUsePowerBombs&&canHellRun(load)),minor("Missiles (HJB)",load=>canAccessRedBrinstar(load)),minor("Missiles (Norfair Reserve 1)",load=>canAccessHeatedNorfair(load)),minor("Missiles (Norfair Reserve 2)",load=>canAccessHeatedNorfair(load)),minor("Missiles (Speed)",load=>canAccessHeatedNorfair(load)),minor("Missiles (Wave)",load=>canAccessHeatedNorfair(load)),major("Reserve Tank (Norfair)",load=>canAccessHeatedNorfair(load)),major("Speed Booster",load=>canAccessHeatedNorfair(load)),major("Wave Beam",load=>canAccessHeatedNorfair(load)),major("Energy Tank (Mama Turtle)",load=>canAccessWreckedShip(load)&&(load.hasGravity||load.hasPressureValve||load.hasHiJump&&(load.hasIce||load.hasSpringBall))&&(load.canFly||load.hasSpeed||load.hasGrapple||load.hasDoubleJump)),minor("Missiles (Beach)",load=>canAccessWestMaridia(load)),minor("Missiles (Mainstreet)",load=>canAccessWreckedShip(load)&&load.canUsePowerBombs&&(load.hasGravity||load.hasPressureValve)&&load.hasSpeed),minor("Missiles (Mama Turtle)",load=>canAccessWestMaridia(load)),major("Missiles (Watering Hole)",load=>canAccessWestMaridia(load)),minor("Supers (Crab)",load=>canAccessWestMaridia(load)),minor("Supers (Watering Hole)",load=>canAccessWestMaridia(load)),major("Energy Tank (Wrecked Ship)",load=>canAccessWreckedShip(load)),major("Gravity Suit",load=>canAccessWreckedShip(load)&&(load.hasVaria&&1<=load.totalTanks||2<=load.totalTanks)),minor("Missiles (Attic)",load=>canAccessWreckedShip(load)),minor("Missiles (Bowling)",load=>canAccessWreckedShip(load)&&(load.hasVaria&&1<=load.totalTanks||2<=load.totalTanks)),minor("Missiles (Ocean Bottom)",load=>canAccessWreckedShip(load)),minor("Missiles (Ocean Middle)",load=>canAccessWreckedShip(load)),major("Missiles (Sky)",load=>canAccessWreckedShip(load)),minor("Missiles (Spooky)",load=>canAccessWreckedShip(load)),major("Reserve Tank (Wrecked Ship)",load=>canAccessWreckedShip(load)&&(load.hasVaria&&1<=load.totalTanks||2<=load.totalTanks)),minor("Supers (WS Left)",load=>canAccessWreckedShip(load)),major("Supers (WS Right)",load=>canAccessWreckedShip(load))}}class BpsPatch{constructor(buffer){this.patchBuffer=buffer}Apply(bytes){if(!BpsPatch.IsBpsPatch(this.patchBuffer))return null;this.patchOffset=4;this.Decode();var targetSize=this.Decode(),metaDataSize=this.Decode(),source=bytes,target=new Uint8Array(targetSize),outputOffset=(0<metaDataSize&&(this.patchOffset+=metaDataSize),0),sourceRelativeOffset=0,targetRelativeOffset=0,eof=this.patchBuffer.length-12;if(!this.VerifyChecksum(source,eof))throw"Source Checksum Mismatch";bytes=this.patchBuffer.slice(0,8+eof);if(!this.VerifyChecksum(bytes,8+eof))throw"Patch Checksum Mismatch";for(;this.patchOffset<eof;){var data=this.Decode(),length=1+(data>>2);switch(3&data){case 0:for(;length--;)target[outputOffset]=source[outputOffset],outputOffset++;break;case 1:for(;length--;)target[outputOffset++]=this.Read();break;case 2:for(sourceRelativeOffset+=(1&(data=this.Decode())?-1:1)*(data>>1);length--;)target[outputOffset++]=source[sourceRelativeOffset++];break;case 3:for(targetRelativeOffset+=(1&(data=this.Decode())?-1:1)*(data>>1);length--;)target[outputOffset++]=target[targetRelativeOffset++]}}if(this.VerifyChecksum(target,4+eof))return target;throw"Target Checksum Mismatch"}static CRC32(buffer){if(void 0===BpsPatch.crcTable){BpsPatch.crcTable=[];for(var n=0;n<256;n++){for(var c=n,k=0;k<8;k++)c=1&c?3988292384^c>>>1:c>>>1;BpsPatch.crcTable[n]=c}}for(var crc=-1,i=0;i<buffer.length;i++)crc=crc>>>8^BpsPatch.crcTable[255&(crc^buffer[i])];return(-1^crc)>>>0}Decode(){for(var data=0,shift=1;;){var x=this.Read();if(data+=(127&x)*shift,0!=(128&x))break;data+=shift<<=7}return data}static IsBpsPatch(bytes){return"BPS1"==new TextDecoder("utf-8").decode(bytes.slice(0,4))}static async Load(FileName){FileName=await(await fetch(FileName)).arrayBuffer(),FileName=new Uint8Array(FileName);return BpsPatch.IsBpsPatch(FileName)?new BpsPatch(FileName):null}Read(){return this.patchBuffer[this.patchOffset++]}VerifyChecksum(bytes,index){bytes=BpsPatch.CRC32(bytes);return(255&bytes)==this.patchBuffer[index]&(bytes>>8&255)==this.patchBuffer[index+1]&(bytes>>16&255)==this.patchBuffer[index+2]&(bytes>>24&255)==this.patchBuffer[index+3]}}class IpsPatch{constructor(buffer){this.hunks=[],this.Process(buffer)}Apply(bytes){var minSize,newBytes;return this.hunks.length<=0?null:(minSize=bytes.length,this.hunks.forEach(function(val,idx){val.GetMinSize()>minSize&&(minSize=val.GetMinSize())}),(newBytes=new Uint8Array(minSize)).set(bytes),this.hunks.forEach(function(val,idex){val.Apply(newBytes)}),newBytes)}Process(buffer){var bytes=new Uint8Array(buffer),buffer=new TextDecoder("utf-8"),start=bytes.slice(0,5);if("PATCH"!=buffer.decode(start))return!1;start=bytes.slice(-3);if("EOF"!=buffer.decode(start))return!1;for(var hunk,PatchIndex=5;null!=(hunk=IpsHunk.Process(bytes,PatchIndex));)this.hunks.push(hunk[0]),PatchIndex=hunk[1];return!0}static async Load(FileName){FileName=await(await fetch(FileName)).arrayBuffer();return new IpsPatch(FileName)}}class IpsHunk{constructor(RLE,Offset,Length,Payload,PayloadIndex){this.rle=RLE,this.offset=Offset,this.length=Length,this.payload=Payload,this.payloadIndex=PayloadIndex}Apply(bytes){if(this.rle)for(var theByte=this.payload[this.payloadIndex],i=0;i<this.length;i++)bytes[this.offset+i]=theByte;else for(i=0;i<this.length;i++)bytes[this.offset+i]=this.payload[this.payloadIndex+i]}GetMinSize(){return this.offset+this.length}static Process(bytes,index){if(index>bytes.length-8)return null;var offset=bytes[index]<<16|bytes[index+1]<<8|bytes[index+2],length=(bytes[index+3]<<8)+bytes[index+4],hunk=(index+=5,null);if(0==length){if(index>bytes.length-6)return null;length=(bytes[index]<<8)+bytes[index+1],hunk=new IpsHunk(!0,offset,length,bytes,index+2),index+=3}else hunk=new IpsHunk(!1,offset,length,bytes,index),index+=length;return[hunk,index]}}const game_modes=[{name:"mm",prefix:"DASH_v11r_SM_",patch:"patches/dash_std.bps",mask:17,title:"Standard - Major / Minor"},{name:"full",prefix:"DASH_v11r_SF_",patch:"patches/dash_std.bps",mask:33,title:"Standard - Full"},{name:"rm",prefix:"DASH_v11r_RM_",patch:"patches/dash_working.bps",mask:18,title:"Recall - Major / Minor"},{name:"rf",prefix:"DASH_v11r_RF_",patch:"patches/dash_working.bps",mask:34,title:"Recall - Full"}],generateSeedPatch=(seed,gameMode,nodes,options)=>{const encodeBytes=(patch,offset,bytes)=>{((patch,offset,length,bytes)=>{patch.push([offset,length,bytes])})(patch,offset,1,bytes)},U16toBytes=u16=>new Uint8Array(new Uint16Array([u16]).buffer);let seedPatch=[],seedFlags=gameMode.mask;gameMode=new DotNetRandom(seed);encodeBytes(seedPatch,3112960,U16toBytes(gameMode.Next(65535))),encodeBytes(seedPatch,3112962,U16toBytes(gameMode.Next(65535))),nodes.forEach(n=>{var itemBytes=n.location.GetItemBytes(n.item.type);encodeBytes(seedPatch,n.location.address,itemBytes)});const mapArea=a=>a==Area.BlueBrinstar?Area.Crateria:a==Area.GreenBrinstar?Area.PinkBrinstar:a,sortedLocations=(eTanks=nodes.filter(n=>n.item.type==Item.EnergyTank).map(n=>mapArea(n.location.area)),majors=nodes.filter(n=>n.item.isMajor&&n.item.type!=Item.EnergyTank&&n.item.type!=Item.Reserve).map(n=>mapArea(n.location.area)),AreaCounts.forEach((addr,area)=>{var numTanks=eTanks.filter(p=>p==area).length,numMajors=majors.filter(p=>p==area).length;encodeBytes(seedPatch,addr,new Uint8Array([numTanks,numMajors]))}),getLocations().sort((a,b)=>a.address-b.address));return nodes.filter(n=>0<n.item.spoilerAddress).forEach(n=>{locIndex=sortedLocations.findIndex(l=>l.address==n.location.address),encodeBytes(seedPatch,n.item.spoilerAddress,U16toBytes(locIndex+1))}),null!=options&&(encodeBytes(seedPatch,3115787,U16toBytes(options.DisableFanfare)),seedFlags|=options.DisableFanfare?256:0),encodeBytes(seedPatch,3115776,(seed=seedFlags,new Uint8Array(new Uint32Array([seed]).buffer))),seedPatch},getFileName=(seed,prefix,options)=>{let fileName=prefix+seed.toString().padStart(6,"0");return null!=options&&1==options.DisableFanfare&&(fileName+="_no_fan"),fileName+".sfc"},patchRom=(vanillaRom,basePatch,seedPatch)=>{let rom=basePatch.Apply(vanillaRom);return seedPatch.forEach(p=>{var[off,cnt,pay]=p;for(let i=0;i<cnt;i++)rom.set(pay,off+i*pay.length)}),rom},generateFromPreset=preset=>{var timestamp=Math.floor((new Date).getTime()/1e3),timestamp=new DotNetRandom(timestamp).NextInRange(1,1e6);if("std_mm"==preset)gameMode=game_modes.find(mode=>"mm"==mode.name),mode=new ModeStandard(timestamp,getLocations()),getPrePool=getMajorMinorPrePool,canPlaceItem=isValidMajorMinor;else if("std_full"==preset)gameMode=game_modes.find(mode=>"full"==mode.name),mode=new ModeStandard(timestamp,getLocations()),getPrePool=getFullPrePool,canPlaceItem=isEmptyNode;else if("mm"==preset||"recall_mm"==preset)gameMode=game_modes.find(mode=>"rm"==mode.name),mode=new ModeRecall(timestamp,getLocations()),getPrePool=getMajorMinorPrePool,canPlaceItem=isValidMajorMinor;else{if("full"!=preset&&"recall_full"!=preset)return console.log("UNKNOWN PRESET: "+preset),["",null,""];gameMode=game_modes.find(mode=>"rf"==mode.name),mode=new ModeRecall(timestamp,getLocations()),getPrePool=getFullPrePool,canPlaceItem=isEmptyNode}preset=new Loadout,preset.hasCharge=!0,performVerifiedFill(timestamp,mode.nodes,mode.itemPool,getPrePool,preset,canPlaceItem),preset=generateSeedPatch(timestamp,gameMode,mode.nodes,null),timestamp=getFileName(timestamp,gameMode.prefix,null);return[gameMode.patch,preset,timestamp]};
